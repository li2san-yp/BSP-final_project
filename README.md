# STC 微控制器项目编译脚本使用说明

## 脚本说明

本项目包含三个编译脚本，满足不同的编译需求：

### 1. compile.bat - 基础编译脚本
- 基本的编译功能
- 详细的编译过程输出
- 适合初学者使用

### 2. build.bat - 高级编译管理脚本 ⭐ 推荐
- 菜单式操作界面
- 支持编译、清理、重新编译
- 显示详细的项目信息
- 支持编译结果查看

### 3. quick_build.bat - 快速编译脚本
- 一键快速编译
- 适合日常开发使用
- 静默模式，只显示结果

## 使用方法

### 直接双击运行
1. 双击 `build.bat` 启动编译管理器
2. 选择相应的操作 (1-5)
3. 按照提示操作

### 命令行运行
```batch
# 进入项目目录
cd d:\BSP-final_project

# 运行高级编译脚本
build.bat

# 或快速编译
quick_build.bat
```

## 配置说明

### Keil C51 路径配置
默认路径：`D:\Keil\C51\BIN`

如需修改，请编辑脚本中的以下行：
```batch
set KEIL_BIN=D:\Keil\C51\BIN
```

### 项目配置
- 项目名称：BSP_Demo
- 源码目录：source/
- 头文件目录：inc/
- 输出目录：output/
- 主要文件：main.c

## 编译参数说明

### C51 编译器参数
- `INCDIR(inc\)` - 指定头文件目录
- `OBJECT(output\main.obj)` - 指定输出目标文件
- `CODE` - 生成代码
- `OPTIMIZE(8,SPEED)` - 优化等级 8，速度优先
- `DEFINE(FOSC_11059200)` - 定义时钟频率
- `DEBUG` - 包含调试信息
- `BROWSE` - 生成浏览信息

### BL51 链接器参数
- `CODE(0X0000-0XEFF8)` - 代码区域
- `XDATA(0X0000-0X06FF)` - 外部数据区域
- `DATA(0X00-0XFF)` - 内部数据区域

## 生成文件说明

编译成功后，在 `output/` 目录下会生成以下文件：

- `BSP_Demo.hex` - Intel HEX 格式文件（用于下载到开发板）
- `BSP_Demo.m51` - 内存映射文件
- `BSP_Demo.lnp` - 链接参数文件
- `main.obj` - 目标文件
- `main.lst` - 汇编列表文件

## 故障排除

### 常见错误

1. **找不到编译器**
   - 检查 Keil C51 是否正确安装
   - 确认路径 `D:\Keil\C51\BIN` 是否正确

2. **编译失败**
   - 检查 C 代码语法错误
   - 确认所有头文件是否存在
   - 查看详细错误信息

3. **链接失败**
   - 检查库文件 `STCBSP_V3.6.LIB` 是否存在
   - 确认内存配置是否正确

4. **生成 HEX 失败**
   - 通常由链接阶段错误引起
   - 检查前面的编译和链接步骤

### 调试方法

1. 使用 `build.bat` 查看详细编译信息
2. 检查 `output/` 目录下的 `.lst` 文件
3. 查看 `.m51` 文件了解内存使用情况

## 开发板下载

编译生成的 `BSP_Demo.hex` 文件可以使用以下工具下载到开发板：

1. **STC-ISP** (推荐)
   - STC 官方下载工具
   - 支持 STC15F2K60S2 系列

2. **其他支持 Intel HEX 格式的编程器**

## 注意事项

1. 确保 Keil C51 编译器已正确安装
2. 项目使用 STC15F2K60S2 微控制器
3. 系统时钟设置为 11.0592MHz
4. 编译前确保所有源文件和头文件完整

## 更新日志

- v1.0 - 初始版本，支持基本编译功能
- v1.1 - 添加菜单式操作界面
- v1.2 - 增加快速编译脚本和错误处理
